---
title: "Distance to perimeter"
author: "Anna Talucci"
date: '2022-10-18'
output: html_document
---

# Overview

Distance from field site to perimeter.

-- To measure the distance to the perimeter polygons need to be converted to line strings
-- Measure done in eaqual area projection

# Packages

```{r}
library(tidyverse)
library(sp)
library(sf)
library(ids)
```

# Projections
```{r}
wgs_proj = "+proj=longlat +datum=WGS84 +no_defs"
```

```{r}
ea_proj = "+proj=aea +lat_0=50 +lon_0=-154 +lat_1=55 +lat_2=65 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"
```

azimuthal equidistant
```{r}
proj_aeqd = "+proj=aeqd +lat_0=90 +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs" 
```

# Data
## Field points by Year

```{r}
fieldpts2015 = st_read("../data/FieldPointsShp/FieldPoints2015.shp", "FieldPoints2015")
fieldpts2019 = st_read("../data/FieldPointsShp/FieldPoints2019.shp", "FieldPoints2019")
fieldpts2020 = st_read("../data/FieldPointsShp/FieldPoints2020.shp", "FieldPoints2020")
fieldpts2021 = st_read("../data/FieldPointsShp/FieldPoints2021.shp", "FieldPoints2021")
```

```{r}
fieldpts2021
```
# Fire perimeters
```{r}
fires = st_read("../data/firePolygons/AK_CA_firePolygons.shp", "AK_CA_firePolygons")
```

```{r}
fires
```

```{r}
munson2021 = st_read("../data/firePolygons/Munson2021AK/235_Munson_Creek_20210805_1337.shp", "235_Munson_Creek_20210805_1337")
```

# Split fires by year

```{r}
fires2015 = fires %>% filter(FireYear == 2015) 
fires2019 = fires %>% filter(FireYear == 2019) 
fires2020 = fires %>% filter(FireYear == 2020)
fires2021 = fires %>% filter(FireYear == 2021)
```

# Fires to equal area projection
```{r}
fires2015ea = st_transform(fires2015, crs = ea_proj)
fires2019ea = st_transform(fires2019, crs = ea_proj)
fires2020ea = st_transform(fires2020, crs = ea_proj)
fires2021ea = st_transform(fires2021, crs = ea_proj)
```

```{r}
munson2021ea = st_transform(munson2021, crs = ea_proj)
```
# Check projection
```{r}
st_crs(fires2020ea)$proj4string
st_crs(fires2020ea)$epsg

st_crs(fieldpts2020)$proj4string
st_crs(fieldpts2020)$epsg

st_crs(munson2021ea)$proj4string
st_crs(munson2021ea)$epsg
```
# Attributes
```{r}
head(fires2015ea)
head(fieldpts2020)
```
# plot fire years
```{r}
ggplot() + 
  geom_sf(data = fires2015ea, fill = "#6C7A86", colour="#A9AB9D") +
  geom_sf(data = fieldpts2015, fill=NA, colour = "#FFFFFF") +
  coord_sf()
```

```{r}
ggplot() + 
  geom_sf(data = fires2019ea, fill = "#6C7A86", colour="#A9AB9D") +
  geom_sf(data = fieldpts2019, fill=NA, colour = "#FFFFFF") +
  coord_sf()
```

```{r}
ggplot() + 
  geom_sf(data = fires2020ea, fill = "#6C7A86", colour="#A9AB9D") +
  geom_sf(data = fieldpts2020, fill=NA, colour = "#FFFFFF") +
  coord_sf()
```

```{r}
ggplot() + 
  geom_sf(data = fires2021ea, fill = "#6C7A86", colour="#A9AB9D") +
  geom_sf(data = fieldpts2021, fill=NA, colour = "#FFFFFF") +
  coord_sf()
```

# Process by year
## 2015
### Distance to edge
```{r}
Fires2015MLS = st_geometry(obj = fires2015ea) %>% st_cast(to = 'MULTILINESTRING')
```
```{r}
edge2015=fieldpts2015 %>%
  mutate(edge_m = st_distance(., Fires2015MLS, by_element=TRUE)) %>%
  st_drop_geometry(.)
```
```{r}
edge2015
```
### Write to cvs
```{r}
write.csv(edge2015,file = "../outputs/EdgeDistance2015.csv")
```

## 2019
### Distance to edge
```{r}
Fires2019MLS = st_geometry(obj = fires2019ea) %>% st_cast(to = 'MULTILINESTRING')
```
```{r}
edge2019=fieldpts2019 %>%
  mutate(edge_m = st_distance(., Fires2019MLS, by_element=TRUE)) %>%
  st_drop_geometry(.)
```
```{r}
edge2019
```
### Write to cvs
```{r}
write.csv(edge2019,file = "../outputs/EdgeDistance2019.csv")
```

## 2020
```{r}
fieldpts2020
```
### Distance to edge
```{r}
st_geometry(obj = fires2020ea) %>% st_cast(to = 'MULTILINESTRING') %>% st_distance(y = fieldpts2020)
```

```{r}
Fires2020MLS = st_geometry(obj = fires2020ea) %>% st_cast(to = 'MULTILINESTRING')
```
```{r}
edge2020=fieldpts2020 %>%
  mutate(edge_m = st_distance(., Fires2020MLS, by_element=TRUE)) %>%
  st_drop_geometry(.)
```

```{r}
edge2020
```
### Write to cvs
```{r}
write.csv(edge2020,file = "../outputs/EdgeDistance2020.csv")
```

## 2021
```{r}
ggplot() + 
  geom_sf(data = munson2021ea, fill = "#6C7A86", colour="#A9AB9D")  +
  coord_sf()
```
### Distance to edge
```{r}
Fires2021MLS = st_geometry(obj = fires2021ea) %>% st_cast(to = 'MULTILINESTRING')
```
```{r}
edge2021=fieldpts2021 %>%
  mutate(edge_m = st_distance(., Fires2021MLS, by_element=TRUE)) %>%
  st_drop_geometry(.)
```

```{r}
edge2021
```

### Write to cvs
```{r}
write.csv(edge2021,file = "../outputs/EdgeDistance2021.csv")
```

