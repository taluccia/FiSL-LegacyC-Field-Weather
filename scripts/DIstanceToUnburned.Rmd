---
title: "Distance To Unburned Test"
author: "Anna Talucci"
date: '2022-10-20'
output: html_document
---
# Overview

Distance from field site to nearest unburned.

-- Process by fire year
-- Take Rasters
-- Convert raster to point 
--
-- Measure distance from point to polygon (st_distance or st_nearest maybe?)

# Packages

```{r}
library(tidyverse)
library(sp)
library(sf)
library(ids)
library(terra)
library(gdalUtilities)
```
# Projections
```{r}
wgs_proj = "+proj=longlat +datum=WGS84 +no_defs"
```

```{r}
ea_proj = "+proj=aea +lat_0=50 +lon_0=-154 +lat_1=55 +lat_2=65 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs"
```

# Data


## Field points by Year

```{r}
fieldpts2015 = st_read("../data/FieldPointsShp/FieldPoints2015.shp", "FieldPoints2015")
fieldpts2019 = st_read("../data/FieldPointsShp/FieldPoints2019.shp", "FieldPoints2019")
fieldpts2020 = st_read("../data/FieldPointsShp/FieldPoints2020.shp", "FieldPoints2020")
fieldpts2021 = st_read("../data/FieldPointsShp/FieldPoints2021.shp", "FieldPoints2021")
```

## Raster
```{r}
r2015<-rast("../data/rasters/unburnedMedian/unburned_Median2015.tif")
r2019<-rast("../data/rasters/unburnedMedian/unburned_Median2019.tif")
r2020<-rast("../data/rasters/unburnedMedian/unburned_Median2020.tif")
r2021<-rast("../data/rasters/unburnedMedian/unburned_Median2021.tif")
```

```{r eval=FALSE, include=FALSE}
r2015
r2019
r2020
r2021
```

```{r eval=FALSE, include=FALSE}
plot(r2015)
plot(r2019)
```

# Process by year

## 2015 
### Raster to points
```{r}
r2015_pts = as.points(r2015, values=TRUE, na.rm=TRUE)
```

### Make into sf object
```{r}
pts2015 = st_as_sf(r2015_pts)
```

### Filter for unburned
```{r}
unburned2015 = pts2015 %>% filter(unburned==1)
```

### Distance to nearest unburned point
```{r}
dist2015= fieldpts2015 %>%
  mutate(nearest = st_nearest_feature(., unburned2015)) %>%
  mutate(dist_m = st_distance(., unburned2015[nearest,], by_element=TRUE)) %>%
  st_drop_geometry(.) 
```

### Write to cvs
```{r}
write.csv(dist2015,file = "../outputs/UnburnedDistance2015.csv")
```

## 2019 
### Raster to points
```{r}
r2019_pts = as.points(r2019, values=TRUE, na.rm=TRUE)
```

### Make into sf object
```{r}
pts2019 = st_as_sf(r2019_pts)
```

### Filter for unburned
```{r}
unburned2019 = pts2019  %>% filter(unburned==1)
```

### Distance to nearest unburned point
```{r}
dist2019= fieldpts2019 %>%
  mutate(nearest = st_nearest_feature(., unburned2019)) %>%
  mutate(dist_m = st_distance(., unburned2019[nearest,], by_element=TRUE)) %>%
  st_drop_geometry(.)
```

### Write to cvs
```{r}
write.csv(dist2019,file = "../outputs/UnburnedDistance2019.csv")
```
## 2020 
### Raster to points
```{r}
r2020_pts = as.points(r2020, values=TRUE, na.rm=TRUE)
```

### Make into sf object
```{r}
pts2020 = st_as_sf(r2020_pts)
```

### Filter for unburned
```{r}
unburned2020 = pts2020  %>% filter(unburned==1)
```

### Distance to nearest unburned point
```{r}
dist2020= fieldpts2020 %>%
  mutate(nearest = st_nearest_feature(., unburned2020)) %>%
  mutate(dist_m = st_distance(., unburned2020[nearest,], by_element=TRUE)) %>%
  st_drop_geometry(.)
```

### Write to cvs
```{r}
write.csv(dist2020,file = "../outputs/UnburnedDistance2020.csv")
```


## 2021 
### Raster to points
```{r}
r2021_pts = as.points(r2021, values=TRUE, na.rm=TRUE)
```

### Make into sf object
```{r}
pts2021 = st_as_sf(r2021_pts)
```

### Filter for unburned
```{r}
unburned2021 = pts2021  %>% filter(unburned==1)
```

### Distance to nearest unburned point
```{r}
dist2021= fieldpts2021 %>%
  mutate(nearest = st_nearest_feature(., unburned2021)) %>%
  mutate(dist_m = st_distance(., unburned2021[nearest,], by_element=TRUE)) %>%
  st_drop_geometry(.)
```

### Write to cvs
```{r}
write.csv(dist2021,file = "../outputs/UnburnedDistance2021.csv")
```
